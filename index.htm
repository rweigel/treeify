<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>Treeify Demo</title>

    <script type="text/javascript" src="js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="js/jstree_pre1.0_stable/jquery.jstree.js"></script>
    <script type="text/javascript" src="js/treeify.js"></script>
    <script type="text/javascript" src="js/testdata.js"></script>
    <script type="text/javascript" src="treeify_test.js"></script>

    <script>

		function isarray(a) {
			if( Object.prototype.toString.call( a ) === '[object Array]' ) {
			    return true;
			}
			return false;
		}
		function isobject(a) {
			if( Object.prototype.toString.call( a ) === '[object Object]' ) {
			    return true;
			}
			return false;
		}

		function createlevel(D) {
			var k = 0;
			if (debug) {
				console.log("creating level for")
				console.log(D);
			}
			var template = new Array();

			if (isarray(D)) {
				for (i = 0; i < D.length; i++) {
					template[i] = new Object();
					template[i].metadata = new Object();
					if (D[i] == "") {
						template[i].metadata = {id: "."};
						template[i].data = ".";
					} else {
						template[i].metadata = {id: D[i]};
						template[i].data =  D[i];
					}
				}
				return template;	
			}
			
			for (key in D) {
				template[k] = new Object();
				template[k].metadata = new Object();

				if (isobject(D[key]) || isarray(D[key])) {
					if (D[key] != "") {
						template[k].metadata = {id: key};
						template[k].data = key;
						template[k].children = createlevel(D[key]);
					} else {
						template[k].metadata = {id: "."};
						template[k].data = key;//".";
						//template[k].children = createlevel(D[key]);
					}
				} else {
					template[k].metadata = {id: D[key]};
					template[k].data = D[key];
					template[k].children = D[key];
				}
				k = k+1;
			}
			if (debug)
				console.log(template);

			return template;
		}

		$(function () {

			for (var i = 1; i < 6; i++) {
				var tmp  = runtest(i-1);
				var DATA = createlevel(tmp);
				console.log(DATA)
				$("body").append("<div id='demo"+i+"'/><hr/>");
				$("#demo"+i).jstree({ 
						"json_data": {"data" : DATA, "progressive_render": true},
						"themes": {"theme":"default","dots":true,"icons":false},
						"plugins": [ "themes", "json_data", "ui" ],
					});
				$("#demo"+i).bind("select_node.jstree", function (e, data) {
					data.inst.open_node();
					console.log(data.inst.get_path());
					console.log(data.rslt.obj.data("id"))
				});
			}

		});

	</script>
  </head>
  <body>
</html>
